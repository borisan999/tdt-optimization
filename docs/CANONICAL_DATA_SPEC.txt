# CANONICAL DATA SPECIFICATION (V2.0)

This document defines the "Canonical JSON" structure which serves as the single source of truth for the entire TDT Optimization System.

## 1. Input Canonical Structure (Stored in `datasets.canonical_json`)
This structure is generated by the Template Generator or the Excel Ingestor.

### A. General Parameters
- `Piso_Maximo` (int): Total number of floors.
- `apartamentos_por_piso` (int): Max units per level.
- `potencia_entrada` (float): Headend signal level in dBÂµV.
- `p_troncal` (int): Floor where the main distribution trunk is located.
- `atenuacion_cable_por_metro` (float): Global loss coefficient (dB/m).
- `atenuacion_conector` (float): Standard loss per F-connector (dB).

### B. Equipment Catalogs
- `derivadores_data` (object): Map of model names to {derivacion, paso, salidas}.
- `repartidores_data` (object): Map of model names to {perdida_insercion, salidas}.

### C. Topology Mapping
- `tus_requeridos_por_apartamento` (object): Key: "Piso|Apto", Value: count.
- `largo_cable_derivador_repartidor` (object): Key: "Piso|Apto", Value: meters.
- `largo_cable_tu` (object): Key: "Piso|Apto|TU_Index", Value: meters.

## 2. Output Canonical Structure (Stored in `results.detail_json`)
This is the immutable snapshot produced by the Python Solver.

### A. Per-TU (Outlet) Detail
Each entry in the array contains:
- `tu_id` (string): Unique identifier (e.g., "B1_P10_A1_TU1").
- `nivel_tu` (float): Calculated signal level at the outlet.
- `cumple` (bool): Whether the level is within the [min, max] normative band.
- `losses` (array): Breakdown of losses per segment:
    - `feeder_cable`: Loss from trunk to block.
    - `riser_dentro_del_bloque`: Loss through vertical riser.
    - `derivador_piso`: Tap attenuation.
    - `cable_derivrep`: Hallway cable loss.
    - `cable_reptu`: Internal apartment cable loss.

### B. Topology Rehydration
- `vertical_distribution`: Aggregated totals for the building backbone.
- `floors`: Hierarchical mapping of Tap -> Splitter -> Outlets used for the Interactive Tree.

## 3. Guarantees
- **Lexicographical Stability:** All keys are sorted alphabetically before hashing.
- **Precision:** All floating-point values are rounded to 4 decimal places in the solver and 2 decimal places in the UI to prevent drift.
